

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Shaar Ha'aretz Magazine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --gold: #c5a059; 
            --dark-bg: #0a0a0b; 
            --cube-size: 240px; 
            --price-tag: #27ae60;
            --mag-red: #d63031;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            margin: 0; background: var(--dark-bg); height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            font-family: 'Segoe UI', system-ui, sans-serif; overflow: hidden; 
            color: white; 
        }
        
        .main-header { 
            width: 100%; padding: 20px 0; text-align: center; 
            background: #000; border-bottom: 1px solid var(--gold); 
            z-index: 100; flex-shrink: 0;
        }
        .main-header h1 { margin: 0; font-size: 24px; letter-spacing: 4px; font-weight: 900; color: #fff; }
        .main-header span { color: var(--gold); font-size: 11px; letter-spacing: 3px; display: block; margin-top: 5px; text-transform: uppercase; }

        .ticker-wrap { background: #111; height: 30px; overflow: hidden; display: flex; align-items: center; border-bottom: 1px solid #222; width: 100%; }
        .ticker { white-space: nowrap; animation: ticker 40s linear infinite; font-size: 12px; color: #eee; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(100%); } }

        .scene { 
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            perspective: 1200px; width: 100%; overflow: hidden; touch-action: none;
        }
        .cube { 
            width: var(--cube-size); height: var(--cube-size); position: relative; 
            transform-style: preserve-3d; transition: transform 0.2s ease-out; 
            margin-bottom: 40px;
        }
        .cube-face { 
            position: absolute; width: var(--cube-size); height: var(--cube-size); 
            border: 1px solid rgba(197, 160, 89, 0.3); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; border-radius: 30px; 
            background: #151518; backface-visibility: hidden; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            cursor: pointer;
        }
        
        .face-magazine { transform: rotateY(0deg) translateZ(120px); border-bottom: 5px solid var(--mag-red); }
        .face-mall     { transform: rotateY(90deg) translateZ(120px); border-bottom: 5px solid #fff; }
        .face-car      { transform: rotateY(180deg) translateZ(120px); border-bottom: 5px solid #3498db; }
        .face-real     { transform: rotateY(-90deg) translateZ(120px); border-bottom: 5px solid #2ed573; }
        .face-join     { transform: rotateX(90deg) translateZ(120px); border-bottom: 5px solid var(--gold); }

        .face-icon { font-size: 50px; color: var(--gold); margin-bottom: 15px; }
        .face-label { font-size: 16px; font-weight: bold; }

        .main-copyright { font-size: 12px; color: var(--gold); opacity: 0.8; text-align: center; letter-spacing: 1px; margin-top: 10px; pointer-events: none; }

        .app-window { position: fixed; inset: 0; background: #f0f2f5; z-index: 1000; display: none; flex-direction: column; color: #1a1a1a; }
        .app-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #000; color: #fff; flex-shrink: 0; }
        .close-btn { background: var(--gold); border: none; color: #000; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .search-container { padding: 10px 15px; background: #fff; border-bottom: 1px solid #ddd; position: relative; flex-shrink: 0; }
        .search-input { width: 100%; padding: 12px 40px 12px 15px; border-radius: 25px; border: 1px solid #ddd; font-size: 16px; outline: none; }
        .search-icon { position: absolute; right: 28px; top: 23px; color: #999; }

        .content { flex: 1; overflow-y: auto !important; padding: 15px; -webkit-overflow-scrolling: touch; }
        .footer-copyright { text-align: center; padding: 20px; font-size: 11px; color: #999; border-top: 1px solid #eee; margin-top: 20px; }

        .pwa-btn { position: fixed; bottom: 20px; left: 20px; background: var(--gold); color: #000; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 90; font-size: 20px; cursor: pointer; }

        .mag-card, .sale-card { background: #fff; border-radius: 12px; margin-bottom: 25px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative;}
        .mag-category { color: var(--mag-red); font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; }
        .mag-title { font-size: 22px; margin: 0 0 10px 0; color: #111; line-height: 1.2; font-weight: 900; }
        .price-badge { position: absolute; top: 15px; left: 15px; background: var(--price-tag); color: #fff; padding: 6px 14px; border-radius: 10px; font-weight: bold; z-index: 5; }
        .card-body { padding: 15px; }
        .btn-group { display: flex; gap: 8px; margin-top: 15px; }
        .btn-main { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none; font-size: 14px; }
        .btn-outline { background: #f1f1f1; color: #333; }
        .btn-gold { background: var(--gold); color: #fff; }
        .full-text { display: none; margin-top: 15px; padding: 15px; background: #f9f9f9; border-radius: 10px; font-size: 15px; line-height: 1.6; border-right: 3px solid var(--gold); }

        .floor-label { grid-column: 1 / -1; margin: 10px 0 6px 0; padding: 6px 10px; background: #111; color: var(--gold); font-weight: 800; border-right: 3px solid var(--gold); border-radius: 2px; font-size: 12px; text-transform: uppercase; }
        .mall-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-bottom: 40px; }
        
        .shop-glass { position: relative; height: 180px; background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.7)); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.05); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: all 0.2s ease; }
        .shop-glass:active { transform: scale(0.97); }
        .glass-logo { width: 60px; height: 60px; object-fit: contain; margin-bottom: 10px; }
        .glass-sign { color: #000; font-weight: 900; font-size: 13px; text-align: center; padding: 0 8px; }
        .buy-tag { margin-top: 6px; font-size: 10px; color: var(--price-tag); font-weight: bold; display: flex; align-items: center; gap: 3px; }
        .glass-handle { position: absolute; right: 8px; top: 45%; width: 2px; height: 25px; background: rgba(0,0,0,0.1); }

        #news-popup { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .pop-box { background: #fff; border-radius: 25px; width: 100%; max-width: 320px; overflow: hidden; border: 2px solid var(--gold); color: #000; padding: 20px; text-align: center;}
    </style>
</head>
<body>

    <header class="main-header">
        <h1>BARKODGLOBAL</h1>
        <span>Shaar Ha'aretz Magazine</span>
    </header>

    <div class="ticker-wrap"><div class="ticker" id="ticker-content">מעדכן...</div></div>

    <div class="scene">
        <div class="cube" id="cube">
            <div class="cube-face face-magazine" onclick="openApp('magazine')"><i class="fa-solid fa-newspaper face-icon"></i><span class="face-label">המגזין</span></div>
            <div class="cube-face face-mall" onclick="openApp('mall')"><i class="fa-solid fa-store face-icon"></i><span class="face-label">Virtual Mall</span></div>
            <div class="cube-face face-car" onclick="openApp('car')"><i class="fa-solid fa-car face-icon"></i><span class="face-label">לוח רכב</span></div>
            <div class="cube-face face-real" onclick="openApp('realestate')"><i class="fa-solid fa-building face-icon"></i><span class="face-label">נדל"ן</span></div>
            <div class="cube-face face-join" onclick="openApp('join')"><i class="fa-solid fa-address-card face-icon"></i><span class="face-label">אודות</span></div>
        </div>
        <div class="main-copyright">כל הזכויות שמורות קופון העיר שיווק והפצה 2025</div>
    </div>

    <div class="pwa-btn" onclick="showPWAInstructions()"><i class="fa-solid fa-plus"></i></div>
    <div id="news-popup" onclick="this.style.display='none'"><div class="pop-box" id="pop-inner"></div></div>

    <div id="magazine-app" class="app-window">
        <div class="app-header"><span>המגזין</span><button class="close-btn" onclick="closeApp('magazine-app')">סגור X</button></div>
        <div class="search-container"><i class="fa-solid fa-magnifying-glass search-icon"></i><input type="text" class="search-input" placeholder="חפש בכתבות..." oninput="filterList('mag-list', this.value)"></div>
        <div class="content" id="mag-list"></div>
    </div>

    <div id="mall-app" class="app-window">
        <div class="app-header"><span>Virtual Mall</span><button class="close-btn" onclick="closeApp('mall-app')">סגור X</button></div>
        <div class="search-container"><i class="fa-solid fa-magnifying-glass search-icon"></i><input type="text" class="search-input" placeholder="חפש חנות..." oninput="filterMall(this.value)"></div>
        <div class="content mall-grid" id="mall-list"></div>
    </div>

    <div id="car-app" class="app-window">
        <div class="app-header"><span>לוח רכב</span><button class="close-btn" onclick="closeApp('car-app')">סגור X</button></div>
        <div class="search-container"><i class="fa-solid fa-magnifying-glass search-icon"></i><input type="text" class="search-input" placeholder="חפש רכב..." oninput="filterList('car-list', this.value)"></div>
        <div class="content" id="car-list"></div>
    </div>

    <div id="realestate-app" class="app-window">
        <div class="app-header"><span>לוח נדל"ן</span><button class="close-btn" onclick="closeApp('realestate-app')">סגור X</button></div>
        <div class="search-container"><i class="fa-solid fa-magnifying-glass search-icon"></i><input type="text" class="search-input" placeholder="חפש נכס..." oninput="filterList('real-list', this.value)"></div>
        <div class="content" id="real-list"></div>
    </div>

    <div id="join-app" class="app-window">
        <div class="app-header"><span>אודות</span><button class="close-btn" onclick="closeApp('join-app')">סגור X</button></div>
        <div class="content" id="about-content"></div>
    </div>

    <script>
        const sheetURL = "https://docs.google.com/spreadsheets/d/1IhvksJ9_H6RmTJbZwQWgWA9Zp3H-2C2aKZef3yE_9sQ/export?format=tsv";
        let rx = -15, ry = 15;
        const copyrightHTML = `<div class="footer-copyright">כל הזכויות שמורות ל-Shaar Ha'aretz Magazine &copy; 2025</div>`;

        function getMedia(url) {
            if (!url || url.length < 5) return '';
            const u = url.trim().toLowerCase();
            
            // זיהוי יוטיוב
            if (u.includes('youtube.com') || u.includes('youtu.be')) {
                let vid = u.includes('v=') ? u.split('v=')[1].split('&')[0] : u.split('/').pop();
                return `<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;margin-bottom:10px;">
                        <iframe src="https://www.youtube.com/embed/${vid}" style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" allowfullscreen></iframe>
                        </div>`;
            }
            
            // זיהוי וידאו ישיר
            if (u.endsWith('.mp4') || u.endsWith('.webm')) {
                return `<video controls style="width:100%; border-radius:12px; margin-bottom:10px;"><source src="${url}" type="video/mp4"></video>`;
            }
            
            // ברירת מחדל תמונה
            return `<div class="media-container"><img src="${url.trim()}" style="width:100%; max-height:280px; object-fit:cover; border-radius:12px;"></div>`;
        }

        async function loadData() {
            try {
                const res = await fetch(sheetURL + '&cb=' + Date.now());
                const text = await res.text();
                const rows = text.replace(/\r/g, "").split('\n').map(r => r.split('\t'));
                const containers = { mag: document.getElementById('mag-list'), mall: document.getElementById('mall-list'), car: document.getElementById('car-list'), real: document.getElementById('real-list'), about: document.getElementById('about-content') };
                Object.values(containers).forEach(c => c.innerHTML = "");
                let tickerHTML = ""; let mallByFloor = {};

                rows.slice(1).forEach(c => {
                    if (!c[1] || c[1].trim() === "") return;
                    const item = { cat: (c[0]||"").trim(), title: (c[1]||"").trim(), price: (c[2]||"").trim(), sum: (c[4]||"").trim(), content: (c[5]||"").trim(), img: (c[6]||"").trim(), target: (c[7]||"").trim(), link: (c[8]||"").trim() };
                    tickerHTML += ` • ${item.title} `;
                    const t = item.target.toLowerCase(); const cat = item.cat.toLowerCase();

                    if (t.includes("אודות")) {
                        containers.about.innerHTML = `<div style="padding:20px;">${item.content}</div>` + copyrightHTML;
                    } else if (t.includes("קניון")) {
                        if (!mallByFloor[item.cat]) mallByFloor[item.cat] = [];
                        mallByFloor[item.cat].push(item);
                    } else if (cat.includes("רכב") || cat.includes("נדל") || cat.includes("נכס")) {
                        let actionButton = "";
                        if (item.link && item.link.trim() !== "" && item.link !== "#") {
                            actionButton = `<a href="${item.link}" target="_blank" class="btn-main btn-gold">לפרטים</a>`;
                        }
                        containers[cat.includes("רכב") ? 'car' : 'real'].innerHTML += `
                            <article class="sale-card">
                                ${item.price ? `<div class="price-badge">${item.price}</div>` : ''}
                                <div class="card-body">
                                    <h2 class="mag-title" style="margin-top:20px">${item.title}</h2>
                                    ${getMedia(item.img)}
                                    <p style="color:#555;">${item.sum}</p>
                                    <div class="btn-group">
                                        <button class="btn-main btn-outline" onclick="toggleCard(this)">מפרט</button>
                                        ${actionButton}
                                    </div>
                                    <div class="full-text">${item.content}</div>
                                </div>
                            </article>`;
                    } else {
                        let actionButton = "";
                        if (item.link && item.link.trim() !== "" && item.link !== "#") {
                            const btnText = item.price ? 'לרכישה' : 'לפרטים';
                            actionButton = `<a href="${item.link}" target="_blank" class="btn-main btn-gold">${btnText}</a>`;
                        }
                        containers.mag.innerHTML += `
                            <article class="mag-card">
                                ${getMedia(item.img)}
                                <div class="card-body">
                                    <span class="mag-category">${item.cat} | Shaar Ha'aretz</span>
                                    <h2 class="mag-title">${item.title}</h2>
                                    <p style="color:#444;">${item.sum}</p>
                                    <div class="btn-group">
                                        <button class="btn-main btn-outline" onclick="toggleCard(this)">קרא עוד</button>
                                        ${actionButton}
                                    </div>
                                    <div class="full-text">${item.content}</div>
                                </div>
                            </article>`;
                    }
                });

                let floorNum = 1;
                for (let floorName in mallByFloor) {
                    containers.mall.innerHTML += `<div class="floor-label">קומה ${floorNum} | ${floorName}</div>`;
                    mallByFloor[floorName].forEach(shop => {
                        containers.mall.innerHTML += `<a href="${shop.link}" target="_blank" class="shop-glass"><img src="${shop.img}" class="glass-logo" onerror="this.style.display='none'"><div class="glass-sign">${shop.title}</div><div class="buy-tag"><i class="fa-solid fa-cart-shopping"></i> לרכישה</div><div class="glass-handle"></div></a>`;
                    });
                    floorNum++;
                }

                ['mag', 'car', 'real', 'mall'].forEach(id => containers[id].innerHTML += copyrightHTML);
                document.getElementById('ticker-content').innerText = tickerHTML;
            } catch (e) { console.error(e); }
        }

        function filterList(listId, val) {
            const q = val.toLowerCase();
            document.querySelectorAll(`#${listId} article`).forEach(art => {
                art.style.display = art.innerText.toLowerCase().includes(q) ? "" : "none";
            });
        }

        function filterMall(val) {
            const q = val.toLowerCase();
            document.querySelectorAll('.shop-glass').forEach(d => d.style.display = d.innerText.toLowerCase().includes(q) ? "" : "none");
            document.querySelectorAll('.floor-label').forEach(f => f.style.display = q === "" ? "" : "none");
        }

        function showPWAInstructions() {
            const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const msg = isiOS ? "לשמירת המגזין כקיצור דרך:<br><br>1. לחץ על כפתור <b>'שתף'</b> בתחתית הדפדפן<br>2. בחר ב-<b>'הוסף למסך הבית'</b>" : "לשמירת המגזין כקיצור דרך:<br><br>1. לחץ על 3 הנקודות למעלה<br>2. בחר ב-<b>'הוסף למסך הבית'</b>";
            document.getElementById('pop-inner').innerHTML = `<h3>הוספה למסך הבית</h3><p>${msg}</p><button class='btn-main btn-gold' style='width:100%'>הבנתי</button>`;
            document.getElementById('news-popup').style.display = 'flex';
        }

        function toggleCard(btn) { const txt = btn.parentElement.nextElementSibling; const open = txt.style.display === "block"; txt.style.display = open ? "none" : "block"; btn.innerText = open ? (btn.innerText.includes("קרא") ? "קרא עוד" : "מפרט") : "סגור"; }
        function openApp(id) { document.getElementById(id + '-app').style.display = 'flex'; }
        function closeApp(id) { document.getElementById(id).style.display = 'none'; }

        let isD = false, lx, ly; const cb = document.getElementById('cube');
        const st = (x, y) => { isD = true; lx = x; ly = y; };
        const mv = (x, y) => { if (!isD) return; ry += (x - lx) * 0.4; rx -= (y - ly) * 0.4; cb.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`; lx = x; ly = y; };
        document.addEventListener('mousedown', e => { if(e.target.closest('.scene')) st(e.
